!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";!function(){jQuery((function(e){e(document).ajaxError((function(){"function"==typeof window._depayUnmountLoading&&window._depayUnmountLoading()})),e(document).ajaxComplete((function(){"function"==typeof window._depayUnmountLoading&&window._depayUnmountLoading()})),e("form.woocommerce-checkout").on("submit",(async()=>{if(e("form.woocommerce-checkout").serialize().match("payment_method=unuspay_wc_payments")){let{unmount:e}=await DePayWidgets.Loading({text:"Loading payment data..."});setTimeout(e,1e4)}}))}));const e=async()=>{if(window.location.hash.startsWith("#wc-unuspay-checkout-")){const e=window.location.hash.match(/wc-unuspay-checkout-(.*?)@/)[1],o=JSON.parse(await wp.apiRequest({path:`/unuspay/wc/checkouts/${e}`,method:"POST"}));if(o.redirect)return void(window.location=o.redirect);const n=[];o.tokens.forEach((e=>{n.push({blockchain:e.blockchain,amount:e.amount,token:e.tokenAddress,receiver:e.receiveAddress,fee:{amount:e.feeRate+"%",receiver:e.feeAddress}})}));let t={accept:n,closed:()=>{window.location.hash="",window.location.reload(!0)},track:{method:o=>new Promise(((n,t)=>{try{wp.apiRequest({path:`/unuspay/wc/checkouts/${e}/track`,method:"POST",data:o}).done((()=>n({status:200}))).fail(((e,o)=>t(o)))}catch(e){t()}})),poll:{method:()=>new Promise(((o,n)=>{wp.apiRequest({path:"/unuspay/wc/release",method:"POST",data:{checkout_id:e}}).done((e=>{o(e)})).fail(o)}))}}};window.UNUSPAY_WC_CURRENCY&&"store"==window.UNUSPAY_WC_CURRENCY.displayCurrency&&function(e){let o,n=e[0],t=1;for(;t<e.length;){const a=e[t],c=e[t+1];if(t+=2,("optionalAccess"===a||"optionalCall"===a)&&null==n)return;"access"===a||"optionalAccess"===a?(o=n,n=c(n)):"call"!==a&&"optionalCall"!==a||(n=c(((...e)=>n.call(o,...e))),o=void 0)}return n}([window,"access",e=>e.UNUSPAY_WC_CURRENCY,"access",e=>e.storeCurrency,"optionalAccess",e=>e.length])&&(t.currency=window.UNUSPAY_WC_CURRENCY.storeCurrency),DePayWidgets.Payment(t)}};document.addEventListener("DOMContentLoaded",e),window.addEventListener("hashchange",e)}()}));
